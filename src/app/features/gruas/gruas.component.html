<div class="space-y-6">
  <section class="card space-y-6 border border-slate-200/60">
    <header class="space-y-2">
      <h2 class="text-xl font-semibold text-slate-900">Nueva grua</h2>
      <p class="text-sm text-slate-500">Registra una grua y asignala a la sede correspondiente.</p>
    </header>
    <form class="space-y-4" [formGroup]="form" (ngSubmit)="crearGrua()">
      <div class="grid gap-4 md:grid-cols-2">
        <label class="text-sm font-medium text-slate-600">
          Codigo
          <input
            formControlName="codigo"
            placeholder="GR-001"
            class="mt-2 w-full rounded-2xl border border-slate-200 bg-white px-4 py-3 text-sm text-slate-900 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200"
          />
        </label>
        <label class="text-sm font-medium text-slate-600">
          Placa
          <input
            formControlName="placa"
            placeholder="ABC123"
            class="mt-2 w-full rounded-2xl border border-slate-200 bg-white px-4 py-3 text-sm text-slate-900 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200"
          />
        </label>
      </div>

      <div class="grid gap-4 md:grid-cols-2">
        <label class="text-sm font-medium text-slate-600">
          Modelo
          <input
            formControlName="modelo"
            placeholder="Referencia o modelo"
            class="mt-2 w-full rounded-2xl border border-slate-200 bg-white px-4 py-3 text-sm text-slate-900 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200"
          />
        </label>
        <label class="text-sm font-medium text-slate-600">
          Capacidad (ton)
          <input
            type="number"
            min="0"
            step="0.1"
            formControlName="capacidadToneladas"
            class="mt-2 w-full rounded-2xl border border-slate-200 bg-white px-4 py-3 text-sm text-slate-900 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200"
          />
        </label>
      </div>

      <div class="grid gap-4 md:grid-cols-2">
        <label class="text-sm font-medium text-slate-600">
          Sede
          <select
            formControlName="sede"
            [disabled]="sedes().length === 1"
            class="mt-2 w-full rounded-2xl border border-slate-200 bg-white px-4 py-3 text-sm text-slate-900 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200 disabled:opacity-60"
          >
            <option value="" disabled>Selecciona una sede</option>
            <option *ngFor="let sede of sedes()" [value]="sede._id">{{ sede.nombre }}</option>
          </select>
        </label>
        <label class="text-sm font-medium text-slate-600">
          Estado
          <select
            formControlName="estado"
            class="mt-2 w-full rounded-2xl border border-slate-200 bg-white px-4 py-3 text-sm text-slate-900 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200"
          >
            <option *ngFor="let estado of estados" [value]="estado">{{ estado }}</option>
          </select>
        </label>
      </div>

      <label class="text-sm font-medium text-slate-600">
        Descripcion
        <textarea
          formControlName="descripcion"
          rows="3"
          placeholder="Observaciones relevantes"
          class="mt-2 w-full rounded-2xl border border-slate-200 bg-white px-4 py-3 text-sm text-slate-900 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200"
        ></textarea>
      </label>

      <button
        type="submit"
        [disabled]="cargando()"
        class="inline-flex items-center justify-center rounded-2xl bg-primary-600 px-4 py-2 text-sm font-semibold text-white shadow-lg shadow-primary-600/20 transition hover:bg-primary-700 disabled:cursor-not-allowed disabled:bg-primary-400"
      >
        {{ cargando() ? 'Guardando...' : 'Registrar grua' }}
      </button>
    </form>
    <p *ngIf="mensaje()" class="text-sm font-medium text-emerald-600">{{ mensaje() }}</p>
  </section>

  <section class="space-y-4">
    <div class="flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between">
      <h2 class="text-lg font-semibold text-slate-900">Gruas registradas</h2>
      <button
        type="button"
        class="inline-flex items-center justify-center rounded-2xl border border-rose-400/60 px-4 py-2 text-sm font-semibold text-rose-600 transition hover:bg-rose-50 disabled:opacity-50"
        (click)="eliminarGrua()"
        [disabled]="!gruaSeleccionada()"
      >
        Eliminar grua
      </button>
    </div>

    <div class="hidden rounded-3xl border border-slate-200 bg-white p-4 shadow-card lg:block">
      <ag-grid-angular
        class="ag-theme-quartz"
        style="width: 100%; height: 480px;"
        [columnDefs]="gruasColumnDefs"
        [defaultColDef]="defaultColDef"
        [rowData]="gruasRowData()"
        [rowSelection]="rowSelection"
        [animateRows]="true"
        [stopEditingWhenCellsLoseFocus]="true"
        (gridReady)="onGridReady($event)"
        (selectionChanged)="onSelectionChanged($event)"
        (cellValueChanged)="onGruaCellValueChanged($event)"
      ></ag-grid-angular>
    </div>

    <div class="space-y-3 lg:hidden">
      <article *ngFor="let grua of gruas()" class="card border border-slate-200/60 shadow-card">
        <header class="flex items-start justify-between gap-3">
          <div>
            <h4 class="text-lg font-semibold text-slate-900">{{ grua.codigo }}</h4>
            <p class="text-xs text-slate-500">Placa: {{ grua.placa }}</p>
          </div>
          <span
            class="chip"
            [ngClass]="{
              'bg-emerald-100 text-emerald-700': grua.estado === 'EN_SERVICIO',
              'bg-amber-100 text-amber-700': grua.estado === 'MANTENIMIENTO',
              'bg-rose-100 text-rose-700': grua.estado === 'INACTIVA'
            }"
          >
            {{ grua.estado }}
          </span>
        </header>
        <div class="mt-3 space-y-2 text-sm text-slate-600">
          <p><span class="font-semibold">Sede:</span> {{ sedeNombre(grua) }}</p>
          <p *ngIf="grua.modelo"><span class="font-semibold">Modelo:</span> {{ grua.modelo }}</p>
          <p *ngIf="grua.capacidadToneladas"><span class="font-semibold">Capacidad:</span> {{ grua.capacidadToneladas }} ton</p>
          <p *ngIf="grua.descripcion"><span class="font-semibold">Notas:</span> {{ grua.descripcion }}</p>
        </div>
        <div class="mt-4 flex flex-wrap gap-2">
          <button type="button" class="rounded-xl border border-slate-300 px-3 py-2 text-sm" (click)="verEnTabla(grua._id)">
            Ver en tabla
          </button>
          <button type="button" class="rounded-xl border border-rose-400 px-3 py-2 text-sm text-rose-600" (click)="seleccionarParaEliminar(grua._id)">
            Eliminar
          </button>
        </div>
      </article>
    </div>

    <p *ngIf="!gruas().length && !cargando()" class="rounded-xl border border-dashed border-slate-300 bg-slate-50 px-4 py-3 text-sm text-slate-500">
      Sin gruas registradas.
    </p>
    <p *ngIf="cargando()" class="text-sm text-slate-500">Cargando gruas...</p>
  </section>
</div>

