<div class="space-y-6">
  <section class="space-y-4">
    <div class="flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between">
      <h2 class="text-lg font-semibold text-slate-900">Sedes registradas</h2>
      <button
        type="button"
        *ngIf="esAdmin()"
        class="inline-flex items-center justify-center rounded-2xl border border-rose-400/60 px-4 py-2 text-sm font-semibold text-rose-600 transition hover:bg-rose-50 disabled:opacity-50"
        (click)="eliminarSede()"
        [disabled]="!sedeSeleccionada()"
      >
        Eliminar sede
      </button>
    </div>
    <p *ngIf="esAdmin()" class="text-xs text-amber-600">
      Eliminar una sede también borrará todas las rutas y recargas asociadas. Esta acción es irreversible.
    </p>
    <p *ngIf="!esAdmin()" class="text-xs text-slate-500">
      Solo los administradores pueden eliminar sedes.
    </p>

    <div class="hidden rounded-3xl border border-slate-200 bg-white p-4 shadow-card lg:block">
      <ag-grid-angular
        class="ag-theme-quartz"
        style="width: 100%; height: 420px;"
        [columnDefs]="sedesColumnDefs"
        [defaultColDef]="defaultColDef"
        [rowData]="sedesRowData()"
        [rowSelection]="rowSelection"
        [stopEditingWhenCellsLoseFocus]="true"
        [animateRows]="true"
        (gridReady)="onGridReady($event)"
        (selectionChanged)="onSelectionChanged($event)"
        (cellValueChanged)="onSedeCellValueChanged($event)"
      ></ag-grid-angular>
    </div>

    <div class="space-y-3 lg:hidden">
      <article *ngFor="let sede of sedes()" class="card border border-slate-200/60 shadow-card">
        <header class="flex items-start justify-between gap-3">
          <div>
            <h4 class="text-lg font-semibold text-slate-900">{{ sede.nombre }}</h4>
            <p class="text-xs text-slate-500">ID: {{ sede._id }}</p>
          </div>
          <span *ngIf="sede.jefe" class="chip bg-primary-100 text-primary-700">Jefe: {{ sede.jefe ? sede.jefe.nombre : ' }}</span>
        </header>
        <div class="mt-3 space-y-2 text-sm text-slate-600">
          <p *ngIf="sede.direccion"><span class="font-semibold">Dirección:</span> {{ sede.direccion }}</p>
          <p *ngIf="sede.telefono"><span class="font-semibold">Teléfono:</span> {{ sede.telefono }}</p>
          <p *ngIf="sede.descripcion"><span class="font-semibold">Notas:</span> {{ sede.descripcion }}</p>
        </div>
        <div class="mt-4 flex flex-wrap gap-2">
          <button type="button" class="rounded-xl border border-slate-300 px-3 py-2 text-sm" (click)="verEnTabla(sede._id)">
            Ver en tabla
          </button>
          <button
            *ngIf="esAdmin()"
            type="button"
            class="rounded-xl border border-rose-400 px-3 py-2 text-sm text-rose-600"
            (click)="seleccionadaId.set(sede._id); eliminarSede()"
          >
            Eliminar
          </button>
        </div>
      </article>
    </div>

    <p *ngIf="!sedes().length && !cargando()" class="rounded-xl border border-dashed border-slate-300 bg-slate-50 px-4 py-3 text-sm text-slate-500">
      Sin sedes registradas.
    </p>
    <p *ngIf="cargando()" class="text-sm text-slate-500">Cargando sedes...</p>
  </section>
  <section class="card space-y-6 border border-slate-200/60">
    <header class="space-y-2">
      <h2 class="text-xl font-semibold text-slate-900">Nueva sede</h2>
      <p class="text-sm text-slate-500">Completa la información para registrar una sede.</p>
    </header>
    <form class="space-y-4" [formGroup]="form" (ngSubmit)="crearSede()">
      <div class="grid gap-4 md:grid-cols-2">
        <label class="text-sm font-medium text-slate-600">
          Nombre
          <input
            formControlName="nombre"
            placeholder="Sede principal"
            class="mt-2 w-full rounded-2xl border border-slate-200 bg-white px-4 py-3 text-sm text-slate-900 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200"
          />
        </label>
        <label class="text-sm font-medium text-slate-600">
          Teléfono
          <input
            formControlName="telefono"
            placeholder="3001234567"
            class="mt-2 w-full rounded-2xl border border-slate-200 bg-white px-4 py-3 text-sm text-slate-900 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200"
          />
        </label>
      </div>

      <label class="text-sm font-medium text-slate-600">
        Dirección
        <input
          formControlName="direccion"
          placeholder="Ciudad, dirección"
          class="mt-2 w-full rounded-2xl border border-slate-200 bg-white px-4 py-3 text-sm text-slate-900 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200"
        />
      </label>

      <label class="text-sm font-medium text-slate-600">
        Descripción
        <textarea
          formControlName="descripcion"
          rows="3"
          placeholder="Notas internas"
          class="mt-2 w-full rounded-2xl border border-slate-200 bg-white px-4 py-3 text-sm text-slate-900 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200"
        ></textarea>
      </label>

      <label class="text-sm font-medium text-slate-600">
        Jefe (opcional)
        <select
          formControlName="jefe"
          class="mt-2 w-full rounded-2xl border border-slate-200 bg-white px-4 py-3 text-sm text-slate-900 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200"
        >
          <option value="">Sin asignar</option>
          <option *ngFor="let jefe of jefes()" [value]="jefe._id">
            {{ jefe.nombre }} - {{ jefe.email }}
          </option>
        </select>
      </label>

      <button
        type="submit"
        [disabled]="cargando()"
        class="inline-flex items-center justify-center rounded-2xl bg-primary-600 px-4 py-2 text-sm font-semibold text-white shadow-lg shadow-primary-600/20 transition hover:bg-primary-700 disabled:cursor-not-allowed disabled:bg-primary-400"
      >
        {{ cargando() ? 'Guardando...' : 'Crear sede' }}
      </button>
    </form>
    <p *ngIf="mensaje()" class="text-sm font-medium text-emerald-600">{{ mensaje() }}</p>
  </section>
  
</div>

